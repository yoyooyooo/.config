# Codex（可选扩展）
#
# 说明：
# - 用于 Codex 通知、prompts 浏览器与状态栏标记。
# - 默认不启用：需要在 `~/.tmux.conf` 里显式 `source-file -q ~/.config/tmux/extensions/codex/tmux.conf`。

# 让脚本/面板能感知“Codex 扩展已启用”（被脚本以 env gate 使用）
set-environment -g TMUX_ENABLE_CODEX 1

# If you use `~/.codex/notify.py`, it can only point to a single handler.
# We set it to our dispatcher so it can fan-out to both our handler(s) and your own.
set-environment -g CODEX_NOTIFY_HANDLER "$HOME/.config/tmux/extensions/codex/notify/dispatch.py"

# pane focus 时尝试确认 “turn complete” 标记（无副作用时是 no-op）
set-hook -ag pane-focus-in 'run -b "~/.config/tmux/extensions/codex/scripts/codex_notify_ack_turn_complete.sh #{pane_id} >/dev/null 2>&1 || true"'

# Codex prompts 双栏浏览器
bind -n M-k display-popup -E -w 80% -h 80% -T "codex-prompts" -d "#{pane_current_path}" -e "ORIGIN_PANE_ID=#{pane_id}" "bash ~/.config/tmux/extensions/codex/scripts/panel/codex_prompts_browser.sh"

# window tabs：未读/完成标记（●）
setw -g window-status-format '#[fg=#c5c8c6] #{?#{||:#{window_activity_flag},#{==:#{@codex_done},1}},#[fg=#{?#{==:#{@codex_done},1},#3fb950,colour208}]●#[fg=#c5c8c6] ,}#{?window_zoomed_flag,#[fg=colour196]⛶#[fg=#c5c8c6] ,}#I:#W '
setw -g window-status-current-format '#[fg=#6cb6ff,bold] #{?#{||:#{window_activity_flag},#{==:#{@codex_done},1}},#[fg=#{?#{==:#{@codex_done},1},#3fb950,colour208}]●#[fg=#6cb6ff] ,}#{?window_zoomed_flag,#[fg=colour196]⛶#[fg=#6cb6ff] ,}#I:#W '
