# tmux-agent extension (portable)
#
# 目标：可开源、可复用，不包含任何机器相关路径。
#
# 用法：
# - 在 `~/.tmux.conf` 里显式启用：
#     source-file -q ~/.config/tmux/extensions/tmux-agent/tmux.conf
# - 如需覆盖 tmux-agent CLI 路径或加载额外绑定，把内容放到：
#     ~/.config/tmux/local/tmux-agent.conf
#   （sync 脚本会排除 local/，不会进仓库）

# 可覆盖：`tmux set -g @tmux_agent_cli /path/to/tmux-agent`
set -g @tmux_agent_cli "tmux-agent"

# 本机私有覆盖（可选）
source-file -q ~/.config/tmux/local/tmux-agent.conf

# 默认 hooks：pane 退出/被杀时标记 stale（下次开面板立刻可见）
set-hook -g pane-exited 'run-shell -b -c "#{pane_current_path}" "#{@tmux_agent_cli} hooks pane-exited --pane #{hook_pane} --server #{b:socket_path} --tmux-session #{hook_session_name} --json >/dev/null 2>&1 || true"'
set-hook -ag after-kill-pane 'run-shell -b -c "#{pane_current_path}" "#{@tmux_agent_cli} hooks after-kill-pane --pane #{hook_pane} --server #{b:socket_path} --tmux-session #{hook_session_name} --json >/dev/null 2>&1 || true"'
