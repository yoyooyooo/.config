# core/base.conf
#
# 基础选项（尽量跨平台）
# - 不包含 hooks / keybindings / theme / plugins
# - 入口：~/.config/tmux/tmux.conf

# -- general
# set-option default-path "$PWD"  # deprecated in tmux 1.9

setw -g xterm-keys on
set-window-option -g xterm-keys on
# 注：escape-time 太小会导致部分“模拟按键/输入法工具”发出的 Meta(ESC 前缀) 被拆成 ESC + 字符，从而匹配不到 M- 绑定。
# 这里取一个仍偏小、但更稳的值（默认是 500ms）。
set -s escape-time 80
set -sg repeat-time 300
set -s focus-events on
set -s extended-keys on
set -as terminal-features 'xterm*:extkeys'
set -g mouse on

set -sg exit-empty on
set -g detach-on-destroy off

set -q -g status-utf8 on
setw -q -g utf8 on

set -g visual-activity off
setw -g monitor-activity on
setw -g monitor-bell off

set -g history-limit 50000

# -- clear（清屏 + 清 tmux scrollback）
# 注：tmux 命令支持缩写，`:clear` 会和 `clear-history/clear-prompt-history` 冲突导致 Ambiguous，所以用 `:cls`
set -s command-alias[0] 'cls=send-keys C-l ; clear-history'

# copy-mode：切回 pane 时如果离底部很近则自动退出（避免持续输出的 TUI “卡住不刷新”）
set -g @copy_mode_auto_cancel_threshold 20

# `M-x` kill-pane double-tap 超时（秒）
set -g @kill_pane_double_tap_timeout_s 1

set -ga update-environment '\
DISPLAY DBUS_SESSION_BUS_ADDRESS \
QT_IM_MODULE QT_QPA_PLATFORMTHEME \
SESSION_MANAGER \
XDG_CONFIG_HOME XDG_CACHE_HOME XDG_DATA_HOME\
XDG_MENU_PREFIX XDG_RUNTIME_DIR XDG_SESSION_CLASS \
XDG_SESSION_DESKTOP XDG_SESSION_TYPE XDG_CURRENT_DESKTOP \
XMODIFIERS \
FZF_DEFAULT_OPTS \
TMUX_THEME_COLOR \
'

# -- prefix
unbind C-b
set -g prefix 'C-a'

# -- display
set -g base-index 0
setw -g pane-base-index 0

setw -g automatic-rename on
setw -g automatic-rename-format '#{?pane_in_mode,[tmux],#{pane_current_command}}#{?pane_dead,[dead],}'
set -g renumber-windows on

set -g set-titles on

set -g display-panes-time 2000
set -g display-time 4000

set -g status-keys emacs
set -g mode-keys vi

# True color support
set -g default-terminal "tmux-256color"
set -as terminal-features ",*256col*:RGB"
set -as terminal-overrides ",*256col*:Tc"
