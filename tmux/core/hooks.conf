# core/hooks.conf
#
# hooks + 启动时 bootstrap（尽量跨平台）

# Clear older activity hooks (keeps activity purely flag-based in status line)
set-hook -gu alert-activity

set-hook -g pane-focus-in "run -b 'bash ~/.config/tmux/scripts/scripts_popup.sh update_mru_pane_ids'"

set-hook -gu client-attached
# set-hook -g client-attached 'run -b "cut -c3- ~/.config/tmux/tmux.conf | sh -s update_env_event"'
set-hook -ag client-attached 'run -b "bash ~/.config/tmux/scripts/last_active_pane.sh record #{q:client_tty} #{pane_id} >/dev/null 2>&1 || true"'
set-hook -ag client-attached 'run -b "tmux refresh-client -S"'

# set-hook -gu client-resized
# set-hook -ag client-resized 'run -b "tmux refresh-client -S"'

set-hook -ag pane-focus-in 'run -b "bash ~/.config/tmux/scripts/last_active_pane.sh record #{q:client_tty} #{pane_id} >/dev/null 2>&1 || true"'
set-hook -ag pane-focus-in 'run -b "tmux refresh-client -S"'
set-hook -gu pane-died

# -- Project-specific window activation hooks
# Checks for ./on-tmux-window-activate.sh or ../on-tmux-window-activate.sh and runs it
set-hook -gu after-select-pane
set-hook -gu after-select-window
set-hook -gu after-split-window
set-hook -gu after-kill-pane
set-hook -gu after-new-window
set-hook -ag after-select-pane 'run -b "~/.config/tmux/scripts/auto_cancel_copy_mode_near_bottom.sh \"#{hook_pane}\" \"#{pane_id}\""'
set-hook -ag after-select-window 'run-shell "~/.config/tmux/scripts/check_and_run_on_activate.sh \"#{pane_current_path}\""'
set-hook -ag after-select-window 'run -b "~/.config/tmux/scripts/update_inactive_pane_bg.sh \"#{window_id}\""'
set-hook -ag after-select-window 'run -b "~/.config/tmux/scripts/auto_cancel_copy_mode_near_bottom.sh \"#{hook_pane}\" \"#{pane_id}\""'
set-hook -ag after-split-window 'run -b "~/.config/tmux/scripts/update_inactive_pane_bg.sh \"#{window_id}\""'
set-hook -ag after-kill-pane 'run -b "~/.config/tmux/scripts/update_inactive_pane_bg.sh \"#{window_id}\""'
set-hook -ag after-new-window 'run -b "~/.config/tmux/scripts/window_rename_from_path.sh \"#{window_id}\" \"#{pane_id}\""'
set-hook -ag after-split-window 'if-shell -F "#{&&:#{!=:#{window_panes},1},#{==:#{window_zoomed_flag},0}}" "select-layout -E" ""'
set-hook -ag after-kill-pane 'if-shell -F "#{&&:#{!=:#{window_panes},1},#{==:#{window_zoomed_flag},0}}" "select-layout -E" ""'
set-hook -ag pane-focus-in 'run -b "~/.config/tmux/scripts/update_inactive_pane_bg.sh \"#{window_id}\""'

# set-hook -ag window-linked 'run -b "tmux refresh-client -S"'
# set-hook -ag window-unlinked 'run -b "tmux refresh-client -S"'
# set-hook -ag window-renamed 'run -b "tmux refresh-client -S"'
# set-hook -ag window-layout-changed 'run -b "tmux refresh-client -S"'
# set-hook -ag after-kill-window 'run -b "tmux refresh-client -S"'
#
# set-hook -gu client-session-changed
# set-hook -g client-session-changed 'run -b "tmux refresh-client -S"'
#
set-hook -gu session-created
set-hook -ag session-created 'run -b "~/.config/tmux/scripts/session_created.sh"'
set-hook -ag session-created 'run -b "tmux refresh-client -S"'

set-hook -gu session-renamed
set-hook -g session-renamed 'run -b "tmux refresh-client -S"'

set-hook -gu session-closed
set-hook -g session-closed 'run -b "tmux refresh-client -S"'

run-shell "~/.config/tmux/scripts/session_created.sh"
